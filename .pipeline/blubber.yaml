version: v4
base: docker-registry.wikimedia.org/golang:1.13-3
lives:
  in: /srv/service/
runs:
  environment:
    APP_BASE_PATH: /srv/service

variants:
  build:
    apt: { packages: [build-essential] }
    runs: { insecurely: true }
    builder:
      command: [make tegola_cmd]
      requirements: [.]
  development:
    includes: [build]
    entrypoint: [cmd/tegola/tegola]
  test:
    includes: [build]
    entrypoint: [make, test]
  prep:
    includes: [build]
  production:
    base: docker-registry.wikimedia.org/python3-build-buster
    copies: [prep]
    entrypoint: [cmd/tegola/tegola]
    apt: { packages: [build-essential, jq, wmf-certificates, curl, libsnappy-dev] }
    python:
      requirements: ["requirements.txt"]
      version: python3
